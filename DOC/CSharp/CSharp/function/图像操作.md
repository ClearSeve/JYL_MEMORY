# 图像操作

## BitmapImage

```
//jpg流转换成BitmapImage
BitmapImage bmp = null;
try
{
    bmp = new BitmapImage();
    bmp.BeginInit();
    bmp.StreamSource = new MemoryStream(imgBytes);
    bmp.EndInit();
}
catch { bmp = null; }

//itmapImage转换成jpg流
bmp.StreamSource.Seek(0, SeekOrigin.Begin);
bmp.StreamSource.Read(imgBytes, 0, imgBytes.Length);

//BitmapImage转bmp
public System.Drawing.Bitmap BitmapImage2Bitmap(BitmapImage bitmapImage)
{
    using (System.IO.MemoryStream outStream = new System.IO.MemoryStream())
    {
        BitmapEncoder enc = new BmpBitmapEncoder();
        enc.Frames.Add(BitmapFrame.Create(bitmapImage));
        enc.Save(outStream);
        System.Drawing.Bitmap bitmap = new System.Drawing.Bitmap(outStream);

        return bitmap; 
    }
}
```

## Bitmap

FileStream fs = new FileStream("D:\\1.jpg", FileMode.Open);  
Bitmap bmp = new Bitmap(fs);//new Bitmap("D:\\1.jpg")  

## Image

Image image = Image.FromFile(imgPathName);  
image = Image.FromStream(Stream);


## 获取图像宽高

```
using (FileStream fs = new FileStream("D:\\1.tif", FileMode.Open, FileAccess.Read))
{
      System.Drawing.Image image = System.Drawing.Image.FromStream(fs);
      int  width = image.Width;
      int  height = image.Height;
}
```

## 修改图像质量

```
public byte[] ChangeImageQuality(byte[] img)
{
    MemoryStream ms = new MemoryStream(img);
    byte[] buffer = null;
    Bitmap bmp = null;
    ImageCodecInfo ici = null;
    System.Drawing.Imaging.Encoder ecd = null;
    EncoderParameter ept = null;
    EncoderParameters eptS = null;
    try
    {
        bmp = new Bitmap(ms);
        ici = this.getImageCoderInfo("image/jpeg");
        ecd = System.Drawing.Imaging.Encoder.Quality;
        eptS = new EncoderParameters(1);
        ept = new EncoderParameter(ecd, 50L);
        eptS.Param[0] = ept;
        //bmp.Save("D:\\xxxx.jpg", ici, eptS);
        MemoryStream stream = new MemoryStream();
        bmp.Save(stream, ici, eptS);
        buffer = new byte[stream.Length];
        stream.Seek(0, SeekOrigin.Begin);
        int len = stream.Read(buffer, 0, buffer.Length);
        if (len != buffer.Length) buffer = null;
    }
    catch (Exception ex)
    {
        return buffer;
    }
    finally
    {
        bmp.Dispose();
        ept.Dispose();
        eptS.Dispose();
    }
    return buffer;   
}
private ImageCodecInfo getImageCoderInfo(string coderType)
{
    ImageCodecInfo[] iciS = ImageCodecInfo.GetImageEncoders();
    ImageCodecInfo retIci = null;
    foreach (ImageCodecInfo ici in iciS)
    {
        if (ici.MimeType.Equals(coderType))
            retIci = ici;
    }
    return retIci;
}
```
